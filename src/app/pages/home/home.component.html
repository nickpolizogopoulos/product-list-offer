<form [formGroup]="form" (ngSubmit)="onSubmit()">

    <section class="container">
        <h3><app-language-switch greek="Πληροφορίες Εταιρείας" english="Company Information" /></h3>
        <section class="info-block">
            <div class="input-50">
                <mat-form-field>
                    <mat-label>
                        <app-language-switch greek="Όνομα Εταιρείας" english="Company Name" />
                    </mat-label>
                    <input matInput formControlName="companyName">
                </mat-form-field>
                @if (companyNameIsInvalid) {
                    <span ErrorMessage 
                        greek="Παρακαλώ, εισάγετε όνομα εταιρείας / επωνυμία."
                        english="Please, enter your company name."
                        classes="error-message"
                    ></span>
                }
            </div>
            <div class="input-50">
                <mat-form-field>
                    <mat-label>
                        <app-language-switch greek="Υπότιτλος Εταιρείας (προαιρετικό)" english="Company Subtitle (optional)" />
                    </mat-label>
                    <input matInput formControlName="companySubtitle">
                </mat-form-field>
            </div>
        </section>
        <section class="info-block">
            <div class="input-25">
                <mat-form-field>
                    <mat-label>
                        <app-language-switch greek="Τηλέφωνο" english="Phone" />
                    </mat-label>
                    <input matInput formControlName="companyPhone">
                </mat-form-field>
                @if (companyPhoneIsInvalid) {
                    <span ErrorMessage 
                        greek="Παρακαλώ, εισάγετε αριθμό τηλεφώνου."
                        english="Please, enter a phone number."
                        classes="error-message"
                    ></span>
                }
            </div>
            <div class="input-25">
                <mat-form-field>
                    <mat-label>
                        <app-language-switch greek="Διευθ. Ηλ. Ταχυδρομείου" english="Email" />
                    </mat-label>
                    <input matInput formControlName="companyEmail" email>
                </mat-form-field>
                @if (companyEmailIsInvalid) {
                    <span ErrorMessage 
                        greek="Παρακαλώ, εισάγετε σωστό email."
                        english="Please, enter a valid email."
                        classes="error-message"
                    ></span>
                }
            </div>
            <div class="input-50">
                <mat-form-field>
                    <mat-label>
                        <app-language-switch greek="Τοποθεσία" english="Location" />
                    </mat-label>
                    <input matInput formControlName="companyLocation">
                </mat-form-field>
                @if (companyLocationIsInvalid) {
                    <span ErrorMessage 
                        greek="Παρακαλώ, εισάγετε τοποθεσία εταιρείας."
                        english="Please, enter your company location."
                        classes="error-message"
                    ></span>
                }
            </div>
        </section>
        <section class="company-details information-headings">
            <article>
                <h4>{{ form.controls.companyName.value }}</h4>
                <h5>{{ form.controls.companySubtitle.value }}</h5>
                <h6>{{ form.controls.companyPhone.value }}</h6>
                <h6>{{ form.controls.companyEmail.value }}</h6>
                <h6>{{ form.controls.companyLocation.value }}</h6>
            </article>
            <article>
                <h4>{{ form.controls.customer.controls.customerName.value }}</h4>
                <h6>{{ form.controls.customer.controls.customerPhone.value }}</h6>
                <h6>{{ form.controls.customer.controls.customerEmail.value }}</h6>
            </article>
        </section>
    </section>

    <section class="container">
        <h3><app-language-switch greek="Πληροφορίες Πελάτη" english="Client Information" /></h3>
        <section class="info-block" formGroupName="customer">
            <div class="input-50">
                <mat-form-field>
                    <mat-label>
                        <app-language-switch greek="Όνομα Πελάτη" english="Client Name" />
                    </mat-label>
                    <input matInput formControlName="customerName">
                </mat-form-field>
                @if (customerNameIsInvalid) {
                    <span ErrorMessage 
                        greek="Παρακαλώ, εισάγετε όνομα / επωνυμία πελάτη."
                        english="Please, enter your customer's name."
                        classes="error-message"
                    ></span>
                }
            </div>
            <div class="input-25">
                <mat-form-field>
                    <mat-label>
                        <app-language-switch greek="Τηλέφωνο" english="Phone" />
                    </mat-label>
                    <input matInput formControlName="customerPhone">
                </mat-form-field>
                @if (customerPhoneIsInvalid) {
                    <span ErrorMessage 
                        greek="Παρακαλώ, εισάγετε αριθμό τηλεφώνου."
                        english="Please, enter a phone number."
                        classes="error-message"
                    ></span>
                }
            </div>
            <div class="input-25">
                <mat-form-field>
                    <mat-label>
                        <app-language-switch greek="Διευθ. Ηλ. Ταχυδρομείου" english="Email" />
                    </mat-label>
                    <input matInput formControlName="customerEmail">
                </mat-form-field>
                @if (customerEmailIsInvalid) {
                    <span ErrorMessage 
                        greek="Παρακαλώ, εισάγετε σωστό email."
                        english="Please, enter a valid email."
                        classes="error-message"
                    ></span>
                }
            </div>
        </section>
    </section>

    <section class="container">
        <h3><app-language-switch greek="Ρυθμίσεις προσφοράς" english="Offer settings" /></h3>
        <section class="settings-block">
            <mat-radio-group [value]="theOfferHasExpirationDate()" (change)="onExpirationChange($event.value)" aria-label="Select an option">
                <mat-radio-button value="permanent">
                    <app-language-switch greek="Η προσφορά είναι μόνιμη" english="The offer is valid permanently" />
                </mat-radio-button>
                <mat-radio-button value="expires">
                    <app-language-switch greek="Με ημερομηνία λήξης" english="With an expiration date" />
                </mat-radio-button>
            </mat-radio-group>

            <div class="expiration-date-box">
                <mat-form-field>
                    <mat-label>
                        <app-language-switch greek="Ημ/νία λήξης προσφοράς" english="Offer expiration date" />
                    </mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="expirationDate">
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
                @if (dateIsInvalid) {
                    <span ErrorMessage 
                        greek="Παρακαλώ κάντε κλικ στο κουμπί δίπλα από το πεδίο εισαγωγής για να επιλέξετε μια ημερομηνία."
                        english="Please click the button next to the input field to select a date."
                        classes="error-message"
                    ></span>
                }
            </div>

        </section>

        <section class="notes-block">
            <button (click)="onNotesSelected()" [color]="!notesEnabled() ? 'primary' : 'warn'" mat-raised-button type="button">
                <mat-icon>{{ !notesEnabled() ? 'add' : 'remove' }}</mat-icon>
                @if (!notesEnabled()) {
                    <app-language-switch greek="Προσθήκη σημειώσεων" english="Add notes" />
                }
                @else {
                    <app-language-switch greek="Διαγραφή σημειώσεων" english="Delete notes" />
                }
            </button>
            @if (notesEnabled()) {
                <mat-form-field class="example-full-width" app>
                    <mat-label>
                        <app-language-switch greek="Σημειώσεις (έως 200 χαρακτήρες)" english="Notes (up to 200 characters)" />
                    </mat-label>
                    <textarea matInput maxlength="200" [rows]="textareaRows()" formControlName="notes"></textarea>
                </mat-form-field>
            }
        </section>
    </section>

    <section class="container" formArrayName="products">
        <section class="products-header">
            <h3><app-language-switch greek="Λίστα προϊόντων" english="Product List" /></h3>
            <app-add-remove-button buttonType="add" (click)="onAddProduct()" />
        </section>
        @for (product of allProducts; track product) {
            <section class="info-block" [formGroupName]="$index">
                <h5>{{ $index + 1 }}<span>.</span></h5>
                <div class="input-50">
                    <mat-form-field>
                        <mat-label>
                            <app-language-switch greek="Τίτλος Προϊόντος" english="Product Title" />
                        </mat-label>
                        <input matInput formControlName="name">
                    </mat-form-field>
                    @if (product.controls.name.invalid && product.controls.name.touched) {
                        <span ErrorMessage 
                          greek="Παρακαλώ, εισάγετε όνομα προϊόντος."
                          english="Please, enter product name."
                          classes="error-message"
                        ></span>
                    }
                </div>
                <div class="input-25">
                    <mat-form-field>
                        <mat-label>
                            <app-language-switch greek="Ποσότητα" english="Quantity" />
                        </mat-label>
                        <mat-select formControlName="quantity" type="number">
                            @for ( option of qtyOptions; track $index ) {
                                <mat-option [value]="option">{{ option }}</mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                    @if (product.controls.quantity.invalid && product.controls.quantity.touched) {
                        <span ErrorMessage 
                          greek="Παρακαλώ, εισάγετε ποσότητα."
                          english="Please, add quantity."
                          classes="error-message"
                        ></span>
                    }
                </div>
                <div class="input-25">
                    <mat-form-field>
                        <mat-label>
                            <app-language-switch greek="Τιμή Μονάδας €" english="Unit Price €" />
                        </mat-label>
                        <input matInput formControlName="price" type="number">
                    </mat-form-field>
                    @if (product.controls.price.invalid && product.controls.price.touched) {
                        <span ErrorMessage 
                          greek="Παρακαλώ εισάγετε τιμή προϊόντος."
                          english="Please, add product price."
                          classes="error-message"
                        ></span>
                    }
                </div>
                <app-add-remove-button buttonType="delete" (click)="onDeleteProduct($index)" />
            </section>
            <mat-divider class="product-divider" />
        }

        <section class="products-header products-header-mobile">
            <h5><app-language-switch greek="Προσθήκη προϊόντος" english="Add Product" /></h5>
            <app-add-remove-button buttonType="add" (click)="onAddProduct()" />
        </section>

        <mat-radio-group [value]="printOption()" (change)="onColouredPdfOptionChange($event.value)" aria-label="Select an option">
            <mat-radio-button value="withColour">
                <app-language-switch greek="Εκτύπωση αρχείου pdf με χρώμα" english="Print coloured pdf file" />
            </mat-radio-button>
            <mat-radio-button value="withoutColour">
                <app-language-switch greek="Αφαίρεση χρωμάτων (εξοικονόμηση μελανιού)" english="Remove colours (saves ink)" />
            </mat-radio-button>
        </mat-radio-group>
        
        <section class="submit-section">
            @if (formIsInvalid) {
                <span ErrorMessage 
                  greek="Παρακαλώ, βεβαιωθείτε ότι όλα τα πεδία είναι συμπληρωμένα σωστά!"
                  english="Please make sure all fields are filled correctly!"
                  classes="form-error-message"
                ></span>
            }
        </section>
        <button type="submit" mat-raised-button>
            <app-language-switch greek="Λήψη αρχείου .pdf" english="Download .pdf file" />
        </button>
    </section>

</form>